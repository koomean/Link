<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Links</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f0c29;
            --card-bg: rgba(255, 255, 255, 0.08);
            --text-color: #ffffff;
            --accent: #00d2ff;
        }
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        /* Profile */
        .profile-section { text-align: center; margin-bottom: 35px; animation: fadeIn 0.8s ease; }
        .profile-img {
            width: 120px; height: 120px; border-radius: 50%;
            border: 3px solid var(--accent); padding: 4px; object-fit: cover;
            margin-bottom: 15px; box-shadow: 0 0 30px rgba(0, 210, 255, 0.3);
        }
        h1 { margin: 0; font-size: 1.8rem; font-weight: 600; }
        p.bio { opacity: 0.7; margin-top: 5px; font-weight: 300; font-size: 0.95rem; }

        /* Links Container */
        .container { width: 100%; max-width: 500px; padding-bottom: 60px; display: flex; flex-direction: column; gap: 14px; }
        
        .link-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            border-radius: 16px;
            text-decoration: none;
            color: white;
            display: flex; align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.25s ease;
            position: relative; overflow: hidden;
        }
        .link-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255,255,255,0.5);
        }

        /* --- Real Brand Icons Colors --- */
        .link-icon { font-size: 1.6rem; margin-right: 18px; width: 35px; text-align: center; transition: 0.3s; }
        
        /* Brand Specific Colors */
        .fa-facebook { color: #1877F2; }
        .fa-youtube { color: #FF0000; }
        .fa-instagram { color: #E4405F; }
        .fa-line { color: #00C300; }
        .fa-tiktok { color: #ff0050; filter: drop-shadow(2px 2px 0px #00f2ea); }
        .fa-google-drive { color: #1FA463; } /* Drive Green */
        .fa-github { color: #ffffff; }
        .fa-envelope { color: #FFC107; }
        .fa-link { color: var(--accent); }

        .link-text { font-size: 1.05rem; font-weight: 500; }
        
        /* Badges */
        .badge {
            margin-left: auto; font-size: 0.75rem;
            padding: 4px 10px; border-radius: 20px;
            font-weight: 600; text-transform: uppercase;
        }
        .badge-vip { background: linear-gradient(45deg, #FFD700, #FFA500); color: #000; }
        .badge-private { background: rgba(255,255,255,0.2); color: #fff; }

        /* Unlock Button */
        .unlock-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            color: #aaa; border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50%; width: 45px; height: 45px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.3s; z-index: 100;
        }
        .unlock-btn.active { color: #00d2ff; border-color: #00d2ff; background: rgba(0, 210, 255, 0.1); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .admin-link { margin-top: auto; color: rgba(255,255,255,0.2); text-decoration: none; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="profile-section" id="profile-section"></div>
    <div class="container" id="links-container">
        <div style="text-align: center; opacity: 0.5;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>

    <a href="admin.html" class="admin-link"><i class="fas fa-cog"></i> Manage</a>

    <button class="unlock-btn" id="unlockBtn" onclick="handleUnlock()">
        <i class="fas fa-lock"></i>
    </button>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const firebaseConfig = {
            apiKey: "AIzaSyB-Brx6cQ7dFhQqbEhDG4xIT4jcVG1yogs",
  authDomain: "mylinks-web.firebaseapp.com",
  projectId: "mylinks-web",
  storageBucket: "mylinks-web.firebasestorage.app",
  messagingSenderId: "702413304222",
  appId: "1:702413304222:web:d255e6c2f428bb1e1d668f",
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let currentAccessGroup = 'public'; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏Ñ‡πà Public
        let accessRules = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏é‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô { "1234": "vip", "5555": "family" }

        function loadData() {
            // 1. ‡πÇ‡∏´‡∏•‡∏î Profile ‡πÅ‡∏•‡∏∞ Access Rules
            db.doc("settings/profile").get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    renderProfile(data);
                    
                    // ‡πÅ‡∏õ‡∏•‡∏á String ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Object
                    // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏ô DB: "1234:vip\n5678:family"
                    if (data.accessConfig) {
                        data.accessConfig.split('\n').forEach(line => {
                            const [code, group] = line.split(':');
                            if(code && group) accessRules[code.trim()] = group.trim();
                        });
                    }
                }
            });

            // 2. ‡πÇ‡∏´‡∏•‡∏î Links (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Order)
            db.collection("links").orderBy("order", "asc").get().then((snapshot) => {
                const container = document.getElementById('links-container');
                container.innerHTML = ''; 

                if(snapshot.empty) {
                    container.innerHTML = '<p style="text-align:center; opacity:0.5;">Empty</p>';
                    return;
                }

                snapshot.forEach((doc) => {
                    const link = doc.data();
                    renderLink(container, link);
                });
            });
        }

        function renderProfile(data) {
            document.getElementById('profile-section').innerHTML = `
                <img src="${data.imageUrl || 'https://ui-avatars.com/api/?name=User'}" class="profile-img">
                <h1>${data.name || 'My Links'}</h1>
                <p class="bio">${data.bio || ''}</p>
            `;
        }

        function renderLink(container, link) {
            // Logic ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
            const linkGroup = link.group || 'public';
            
            // ‡∏ñ‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Public ‡πÅ‡∏•‡∏∞ ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå -> ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á
            if (linkGroup !== 'public' && linkGroup !== currentAccessGroup) return;

            const iconClass = link.icon || 'fas fa-link';
            let badge = '';
            
            if (linkGroup !== 'public') {
                badge = `<span class="badge badge-vip">${linkGroup}</span>`;
            }

            const html = `
                <a href="${link.url}" target="_blank" class="link-card">
                    <div class="link-icon"><i class="${iconClass}"></i></div>
                    <div class="link-text">${link.title}</div>
                    ${badge}
                </a>
            `;
            container.innerHTML += html;
        }

        function handleUnlock() {
            if (currentAccessGroup !== 'public') {
                // Logout (‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô public)
                currentAccessGroup = 'public';
                alert("üîí ‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß");
                document.getElementById('unlockBtn').classList.remove('active');
                document.getElementById('unlockBtn').innerHTML = '<i class="fas fa-lock"></i>';
                loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
            } else {
                // Login
                const input = prompt("üîë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á:");
                if (input && accessRules[input]) {
                    currentAccessGroup = accessRules[input]; // ‡πÑ‡∏î‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÉ‡∏™‡πà
                    alert(`üîì ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°: ${currentAccessGroup.toUpperCase()}`);
                    document.getElementById('unlockBtn').classList.add('active');
                    document.getElementById('unlockBtn').innerHTML = '<i class="fas fa-unlock"></i>';
                    loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                } else if (input) {
                    alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                }
            }
        }

        loadData();
    </script>
</body>
</html>
